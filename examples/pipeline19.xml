<PIPELINE>
	<MODULE seq="001" name="FILE PROCESSING">
		<FUNCTION name="LOAD FILE">
			<REGEXP>nuclei.jpg</REGEXP>
			<OUTPUT>NUCLEI</OUTPUT>
		</FUNCTION>
	</MODULE>
	<MODULE seq="002" name="FILE PROCESSING">
		<FUNCTION name="SHOW">
			<INPUT>NUCLEI</INPUT>
			<WINDOWSNAME>NULL</WINDOWSNAME>
			<WIDTH>510</WIDTH>
			<HEIGHT>510</HEIGHT>
			<TYPE>WINDOW</TYPE>
		</FUNCTION>
	</MODULE> 
	<MODULE seq="003" name="IMAGE PROCESSING">
		<FUNCTION name="ADAPTATIVE THRESHOLD">
			<INPUT>NUCLEI</INPUT>			
			<THRESHOLD_TYPE>BINARY</THRESHOLD_TYPE>
			<METHOD>GAUSSIAN</METHOD>
			<CONSTANT>0</CONSTANT>
			<BLOCKSIZE>71</BLOCKSIZE>
			<ASHOW>TRUE</ASHOW>
			<WINDOWSNAME>THRESHOLD</WINDOWSNAME>
			<OUTPUT>NUC_T</OUTPUT>
		</FUNCTION>
	</MODULE> 
	<MODULE seq="004" name="IMAGE PROCESSING">
		<FUNCTION name="MAKE BRUSH">
			<ASHOW>FALSE</ASHOW>
			<WINDOWSNAME>MY BRUSH</WINDOWSNAME>
			<BRUSH_SIZE_X>7</BRUSH_SIZE_X>
			<BRUSH_SIZE_Y>7</BRUSH_SIZE_Y>
			<BRUSH_TYPE>GAUSSIAN_SHAPE</BRUSH_TYPE>
			<SIGMA>0.2</SIGMA>
			<OUTPUT>BRUSH NUMBER 1</OUTPUT>
		</FUNCTION>
	</MODULE>
    <MODULE seq="005" name="IMAGE PROCESSING">
		<FUNCTION name="MORPHOLOGICAL OPERATION">
			<ASHOW>TRUE</ASHOW>
			<WINDOWSNAME>OPENING</WINDOWSNAME>
			<OPERATION>OPENING</OPERATION>
			<INPUT>NUC_T</INPUT>
			<ITERATIONS>1</ITERATIONS>
			<BRUSH>BRUSH NUMBER 1</BRUSH>
			<OUTPUT>NUC_END</OUTPUT>
		</FUNCTION>
	</MODULE>
	<MODULE seq="006" name="SEGMENTATION PROCESSING">
		<FUNCTION name="LABEL">
			<INPUT>NUC_END</INPUT>
			<OUTPUT>NUC_OBJ</OUTPUT>
		</FUNCTION>
	</MODULE>
	<MODULE seq="007" name="FILE PROCESSING">
		<FUNCTION name="PAINT OBJECTS">
			<ASHOW>TRUE</ASHOW>
			<WINDOWSNAME>Painted</WINDOWSNAME>
			<INPUT_1>NUC_END</INPUT_1>
			<COLOUR>RANDOM</COLOUR>
			<THICKNESS>0</THICKNESS>
			<LOAD_OBJECTS>NUC_OBJ</LOAD_OBJECTS>
			<PAINT_CONTOURS>FALSE</PAINT_CONTOURS>
			<OUTPUT>IMAGEX2</OUTPUT>
			<WIDTH>510</WIDTH>
			<HEIGHT>510</HEIGHT>
		</FUNCTION>
	</MODULE>  
	<MODULE seq="008" name="FILE PROCESSING">
		<FUNCTION name="LOAD FILE">
			<REGEXP>cells.jpg</REGEXP>
			<OUTPUT>BODIES</OUTPUT>
		</FUNCTION>
	</MODULE>
	<MODULE seq="009" name="FILE PROCESSING">
		<FUNCTION name="SHOW">
			<INPUT>BODIES</INPUT>
			<WINDOWSNAME>NULL</WINDOWSNAME>
			<WIDTH>510</WIDTH>
			<HEIGHT>510</HEIGHT>
			<TYPE>WINDOW</TYPE>
		</FUNCTION>
	</MODULE> 
<!--	<MODULE seq="010" name="IMAGE PROCESSING">
		<FUNCTION name="ADAPTATIVE THRESHOLD">
			<INPUT>BODIES</INPUT>			
			<THRESHOLD_TYPE>THRESH_BINARY_16</THRESHOLD_TYPE>
			<METHOD>GAUSSIAN</METHOD>
			<CONSTANT>0.01</CONSTANT>
			<BLOCKSIZE>75</BLOCKSIZE>
			<ASHOW>TRUE</ASHOW>
			<WINDOWSNAME>THRESHOLD_2</WINDOWSNAME>
			<OUTPUT>MASK_BIN</OUTPUT>
		</FUNCTION>
	</MODULE> -->
	<MODULE seq="010" name="IMAGE PROCESSING">
		<FUNCTION name="THRESHOLD">
			<INPUT>BODIES</INPUT>
			<THRESHOLD>0.14</THRESHOLD>
			<THRESHOLD_TYPE>THRESH_BINARY</THRESHOLD_TYPE>
			<MAX_THRESHOLD>1</MAX_THRESHOLD>
			<ASHOW>TRUE</ASHOW>
			<WINDOWSNAME>THRESHOLD_2</WINDOWSNAME>
			<OUTPUT>MASK_BIN</OUTPUT>
		</FUNCTION>
	</MODULE> 
	<MODULE seq="011" name="IMAGE PROCESSING">
		<FUNCTION name="MAKE BRUSH">
			<ASHOW>FALSE</ASHOW>
			<WINDOWSNAME>MY BRUSH</WINDOWSNAME>
			<BRUSH_SIZE_X>2</BRUSH_SIZE_X>
			<BRUSH_SIZE_Y>2</BRUSH_SIZE_Y>
			<BRUSH_TYPE>GAUSSIAN_SHAPE</BRUSH_TYPE>
			<SIGMA>2.0</SIGMA>
			<OUTPUT>BRUSH NUMBER 2</OUTPUT>
		</FUNCTION>
	</MODULE>
	<MODULE seq="011" name="IMAGE PROCESSING">
		<FUNCTION name="DILATE">
			<ASHOW>TRUE</ASHOW>
			<WINDOWSNAME>DILATION</WINDOWSNAME>
			<INPUT>MASK_BIN</INPUT>
			<BRUSH>BRUSH NUMBER 2</BRUSH>
			<ITERATIONS>1</ITERATIONS>
			<OUTPUT>MASK</OUTPUT>
		</FUNCTION>
	</MODULE>
	<MODULE seq="012" name="IMAGE PROCESSING">
		<FUNCTION name="MORPHOLOGICAL OPERATION">
			<ASHOW>TRUE</ASHOW>
			<WINDOWSNAME>OPENING</WINDOWSNAME>
			<OPERATION>OPENING</OPERATION>
			<INPUT>MASK</INPUT>
			<ITERATIONS>1</ITERATIONS>
			<BRUSH>BRUSH NUMBER 1</BRUSH>
			<OUTPUT>MASK2</OUTPUT>
		</FUNCTION>
	</MODULE>
	<MODULE seq="006" name="IMAGE PROCESSING">
		<FUNCTION name="GAUSSIAN BLUR">
			<ASHOW>TRUE</ASHOW>
			<WINDOWSNAME>GBLUR</WINDOWSNAME>
			<WIDTH>3</WIDTH>
			<HEIGHT>3</HEIGHT>
			<SIGMA_X>0</SIGMA_X>
			<SIGMA_Y>0</SIGMA_Y>
			<INPUT>BODIES</INPUT>
			<OUTPUT>BODIESG</OUTPUT>
		</FUNCTION>
	</MODULE>
	<MODULE seq="013" name="SEGMENTATION PROCESSING">
		<FUNCTION name="PROPAGATE">
			<SEEDS>NUC_OBJ</SEEDS>
			<INPUT>BODIESG</INPUT>
			<MASK>MASK2</MASK>
			<SAVE_OBJ>BODIES_OBJ</SAVE_OBJ>
			<LAMBDA>0.001</LAMBDA>
		</FUNCTION>
	</MODULE> 
	<MODULE seq="014" name="FILE PROCESSING">
		<FUNCTION name="RGB IMAGE">
			<RED_CHANNEL>NULL</RED_CHANNEL>
			<GREEN_CHANNEL>BODIES</GREEN_CHANNEL>
			<BLUE_CHANNEL>NUCLEI</BLUE_CHANNEL>
			<ASHOW>FALSE</ASHOW>
			<WINDOWSNAME>IMAGE COMPOSITION</WINDOWSNAME>
			<OUTPUT>IMAGE7</OUTPUT>
		</FUNCTION>
	</MODULE>
		<MODULE seq="015" name="FILE PROCESSING">
		<FUNCTION name="PAINT OBJECTS">
			<ASHOW>FALSE</ASHOW>
			<WINDOWSNAME>Painted bodies</WINDOWSNAME>
			<INPUT>IMAGE7</INPUT>
			<COLOUR>#ff00ff</COLOUR>
			<THICKNESS>0</THICKNESS>
			<LOAD_OBJECTS>BODIES_OBJ</LOAD_OBJECTS>
			<PAINT_CONTOURS>TRUE</PAINT_CONTOURS>
			<OUTPUT>IMAGE_BODIES</OUTPUT>
			<WIDTH>510</WIDTH>
			<HEIGHT>510</HEIGHT>
		</FUNCTION>
	</MODULE>  
	<MODULE seq="016" name="FILE PROCESSING">
		<FUNCTION name="PAINT OBJECTS">
			<ASHOW>TRUE</ASHOW>
			<WINDOWSNAME>Painted bodies</WINDOWSNAME>
			<INPUT>IMAGE_BODIES</INPUT>
			<COLOUR>YELLOW</COLOUR>
			<THICKNESS>0</THICKNESS>
			<LOAD_OBJECTS>NUC_OBJ</LOAD_OBJECTS>
			<PAINT_CONTOURS>TRUE</PAINT_CONTOURS>
			<OUTPUT>IMAGE_BODIES</OUTPUT>
			<WIDTH>510</WIDTH>
			<HEIGHT>510</HEIGHT>
		</FUNCTION>
	</MODULE>  
	<MODULE seq="017" name="FILE PROCESSING">
		<FUNCTION name="WRITE FILE">
			<INPUT>IMAGE_BODIES</INPUT>
			<!-- PNG 0-9 default should be 3 -->
			<!-- JP2 requires the libraries installed in your system -->
			<!-- TIFF or TIF, PGM,PBM,PPM -->
			<FILEEXT>PNG</FILEEXT>
			<P_COMPRESSIONLEVEL>3</P_COMPRESSIONLEVEL>
			<FOUTPUT>MYIMAGE</FOUTPUT>
			<APPEND_ORIGINAL_NAME>TRUE</APPEND_ORIGINAL_NAME>
			<APPEND_DATE>TRUE</APPEND_DATE>
		</FUNCTION>
	</MODULE> 
</PIPELINE>
